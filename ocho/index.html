<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Bird vs Traffic</title>
    <style>
        :root {
            --bg-road: #34495e;
            --bg-grass: #27ae60;
            --ui-bg: #2c3e50;
            --accent: #f1c40f;
            --text: #ecf0f1;
        }
        
        body {
            font-family: 'Segoe UI', sans-serif;
            background-color: var(--ui-bg);
            color: var(--text);
            margin: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden; /* Evitar scroll */
            user-select: none;
            -webkit-user-select: none;
        }

        /* --- 1. UI (Fuera del Canvas) --- */
        #hud {
            display: flex;
            justify-content: space-around;
            align-items: center;
            padding: 15px;
            background: #1a252f;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
            z-index: 20;
            height: 60px;
            box-sizing: border-box;
        }

        .stat-box {
            font-size: 1.2rem;
            font-weight: bold;
        }
        .stat-label { font-size: 0.8rem; opacity: 0.7; margin-right: 5px; }
        .stat-value { color: var(--accent); font-size: 1.4rem; }

        /* --- 2. √ÅREA DE JUEGO (La Ciudad) --- */
        #game-stage {
            flex-grow: 1; /* Ocupa el resto de la pantalla */
            position: relative;
            overflow: hidden;
            cursor: none; /* Cursor nativo oculto */
            
            /* Patr√≥n de Ciudad (Calles) con CSS */
            background-color: var(--bg-road);
            background-image: 
                linear-gradient(90deg, transparent 48%, #fff 48%, #fff 52%, transparent 52%),
                linear-gradient(transparent 48%, #fff 48%, #fff 52%, transparent 52%);
            background-size: 100px 100px;
            
            /* Animaci√≥n de vuelo (Mueve el fondo) */
            animation: flyOverCity 2s linear infinite;
        }

        @keyframes flyOverCity {
            from { background-position: 0 0; }
            to { background-position: 0 100px; }
        }

        /* --- 3. EL P√ÅJARO (Cursor Personalizado) --- */
        #bird-container {
            position: absolute;
            top: -100px; left: -100px; /* Fuera inicialmente */
            pointer-events: none; /* Magia: El click atraviesa al p√°jaro */
            z-index: 1000;
            transition: transform 0.1s;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        #bird-body {
            font-size: 50px;
            z-index: 2;
            filter: drop-shadow(0 5px 5px rgba(0,0,0,0.2));
        }

        /* Sombra separada para dar efecto de altura */
        #bird-shadow {
            width: 20px;
            height: 10px;
            background: rgba(0,0,0,0.5);
            border-radius: 50%;
            margin-top: 20px; /* Distancia del suelo */
            z-index: 1;
            filter: blur(2px);
        }

        /* Animaci√≥n de picotazo */
        .pecking #bird-body {
            animation: dive 0.2s ease-in-out;
        }
        .pecking #bird-shadow {
            animation: shadowScale 0.2s ease-in-out;
        }

        @keyframes dive {
            0% { transform: scale(1) translateY(0); }
            50% { transform: scale(0.8) translateY(15px); } /* Baja hacia la calle */
            100% { transform: scale(1) translateY(0); }
        }
        @keyframes shadowScale {
            0% { transform: scale(1); opacity: 0.5; }
            50% { transform: scale(1.5); opacity: 0.8; } /* La sombra crece al acercarse */
            100% { transform: scale(1); opacity: 0.5; }
        }

        /* --- 4. OBJETIVOS (Coches) --- */
        .car {
            position: absolute;
            font-size: 40px;
            width: 50px;
            height: 50px;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer; /* Fallback */
            transition: transform 0.1s;
            /* Sombra del coche */
            filter: drop-shadow(2px 4px 4px rgba(0,0,0,0.4));
        }
        .car:active { transform: scale(0.9); }

        /* Pantalla de Men√∫ */
        #menu-overlay {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(44, 62, 80, 0.9);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            text-align: center;
        }
        button {
            background: var(--accent);
            border: none;
            color: #333;
            padding: 15px 40px;
            font-size: 1.5rem;
            font-weight: bold;
            border-radius: 50px;
            cursor: pointer;
            margin-top: 20px;
            box-shadow: 0 5px 0 #c0392b;
        }
        button:active { transform: translateY(4px); box-shadow: none; }

    </style>
</head>
<body>

    <!-- UI SUPERIOR -->
    <div id="hud">
        <div class="stat-box"><span class="stat-label">TIEMPO</span><span id="timer" class="stat-value">30</span></div>
        <div class="stat-box"><span class="stat-label">PUNTOS</span><span id="score" class="stat-value">0</span></div>
    </div>

    <!-- JUEGO -->
    <div id="game-stage">
        
        <!-- P√°jaro + Sombra -->
        <div id="bird-container">
            <div id="bird-body">ü¶Ö</div>
            <div id="bird-shadow"></div>
        </div>

        <!-- Contenedor donde aparecen los coches -->
        <div id="traffic-layer"></div>

        <!-- Men√∫ Overlay -->
        <div id="menu-overlay">
            <h1>BIRD vs TRAFFIC</h1>
            <p style="max-width: 80%; line-height: 1.5;">
                ¬°Est√°s sobrevolando la ciudad!<br>
                Usa tu puntero (o dedo) para atrapar los coches.<br>
                ¬°Cuidado con el tr√°fico!
            </p>
            <button id="btn-start">DESPEGAR</button>
        </div>
    </div>

<script>
    // --- CONFIGURACI√ìN Y VARIABLES ---
    const stage = document.getElementById('game-stage');
    const bird = document.getElementById('bird-container');
    const trafficLayer = document.getElementById('traffic-layer');
    const scoreEl = document.getElementById('score');
    const timeEl = document.getElementById('timer');
    const menu = document.getElementById('menu-overlay');
    const btnStart = document.getElementById('btn-start');

    let score = 0;
    let timeLeft = 30;
    let gameInterval = null;
    let spawnInterval = null;
    let isPlaying = false;

    // Emojis de veh√≠culos
    const cars = ['üöó', 'üöï', 'üöô', 'üöì', 'üèéÔ∏è', 'üöö'];

    // --- L√ìGICA DE INPUT (M√≥vil y PC) ---

    // Funci√≥n unificada para mover el p√°jaro
    function moveBird(x, y) {
        // Restar la posici√≥n del HUD para coordenadas relativas correctas si fuera necesario,
        // pero como stage tiene position:relative, usamos coordenadas directas del evento dentro del stage
        // o ajustamos por getBoundingClientRect.
        
        const rect = stage.getBoundingClientRect();
        // Asegurar que el p√°jaro no se salga visualmente demasiado
        let localX = x - rect.left;
        let localY = y - rect.top;

        bird.style.left = (localX - 25) + 'px'; // 25 es la mitad del ancho aprox
        bird.style.top = (localY - 50) + 'px'; // Un poco m√°s arriba para que la sombra caiga en el dedo
    }

    // PC: Mouse
    stage.addEventListener('mousemove', (e) => {
        moveBird(e.clientX, e.clientY);
        
        // Rotaci√≥n simple
        if (e.movementX > 0) bird.style.transform = "scaleX(-1)";
        else if (e.movementX < 0) bird.style.transform = "scaleX(1)";
    });

    stage.addEventListener('mousedown', () => peck());

    // M√ìVIL: Touch
    stage.addEventListener('touchmove', (e) => {
        e.preventDefault(); // Evitar scroll de pantalla
        const touch = e.touches[0];
        moveBird(touch.clientX, touch.clientY);
    }, { passive: false });

    stage.addEventListener('touchstart', (e) => {
        const touch = e.touches[0];
        moveBird(touch.clientX, touch.clientY);
        peck();
    }, { passive: false });


    function peck() {
        bird.classList.add('pecking');
        setTimeout(() => bird.classList.remove('pecking'), 200);
    }

    // --- L√ìGICA DEL JUEGO ---

    btnStart.addEventListener('click', startGame);

    function startGame() {
        score = 0;
        timeLeft = 30;
        isPlaying = true;
        updateHUD();
        
        menu.style.display = 'none';
        trafficLayer.innerHTML = ''; // Limpiar coches viejos

        // Loop de Tiempo
        gameInterval = setInterval(() => {
            timeLeft--;
            updateHUD();
            if (timeLeft <= 0) gameOver();
        }, 1000);

        // Loop de Spawneo (M√°s r√°pido que antes)
        spawnCar(); // Primer coche
    }

    function spawnCar() {
        if (!isPlaying) return;

        const carEl = document.createElement('div');
        carEl.classList.add('car');
        carEl.textContent = cars[Math.floor(Math.random() * cars.length)];

        // Posici√≥n Din√°mica (basada en tama√±o real de ventana)
        const w = stage.clientWidth - 60;
        const h = stage.clientHeight - 60;
        
        const x = Math.random() * w;
        const y = Math.random() * h;

        carEl.style.left = x + 'px';
        carEl.style.top = y + 'px';

        // Orientaci√≥n del coche (arriba/abajo simulando carriles)
        // Si est√° en la mitad izquierda, mira abajo, si no, arriba (simulaci√≥n de tr√°fico)
        if (x < w / 2) {
            carEl.style.transform = "rotate(180deg)"; // Baja
        } else {
            carEl.style.transform = "rotate(0deg)"; // Sube
        }

        // Evento de captura
        // Usamos 'pointerdown' para cubrir click y touchStart
        carEl.addEventListener('pointerdown', (e) => {
            e.stopPropagation(); // Que no dispare doble evento en el stage
            catchCar(carEl);
        });

        trafficLayer.appendChild(carEl);

        // El coche desaparece si no lo atrapas r√°pido (hace el juego m√°s din√°mico)
        const lifeTime = setTimeout(() => {
            if(carEl.parentNode) carEl.remove();
            if(isPlaying && trafficLayer.childElementCount < 3) spawnCar(); 
        }, 2000); // 2 segundos de vida por coche

        // Spawnear siguiente coche
        if (isPlaying) {
            let nextSpawnTime = Math.random() * 800 + 400; // Entre 0.4 y 1.2 seg
            setTimeout(spawnCar, nextSpawnTime);
        }
    }

    function catchCar(el) {
        if (!isPlaying) return;
        
        score += 10;
        updateHUD();
        
        // Efecto visual al atrapar
        el.style.transition = "all 0.1s";
        el.style.transform = "scale(1.5) rotate(360deg)";
        el.style.opacity = "0";
        
        setTimeout(() => el.remove(), 100);
        peck(); // Forzar animaci√≥n del p√°jaro
    }

    function updateHUD() {
        scoreEl.textContent = score;
        timeEl.textContent = timeLeft;
        
        // Alerta visual de poco tiempo
        if(timeLeft <= 5) timeEl.style.color = "red";
        else timeEl.style.color = "var(--accent)";
    }

    function gameOver() {
        isPlaying = false;
        clearInterval(gameInterval);
        
        const h1 = menu.querySelector('h1');
        const p = menu.querySelector('p');
        
        h1.textContent = "¬°FIN DEL VUELO!";
        p.innerHTML = `Atrapaste coches por valor de <br><strong style="font-size:2rem; color:#f1c40f">${score}</strong> puntos`;
        btnStart.textContent = "VOLAR DE NUEVO";
        
        menu.style.display = 'flex';
    }

</script>
</body>
</html>